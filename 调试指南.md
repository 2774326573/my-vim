# Vim è°ƒè¯•æŒ‡å— (Vimspector)

## ğŸ› è°ƒè¯•å™¨ç®€ä»‹

Vimspector æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å›¾å½¢åŒ–è°ƒè¯•å™¨ï¼Œæ”¯æŒå¤šç§è¯­è¨€ï¼š
- C/C++ (gdb, lldb)
- Python (debugpy)
- JavaScript/TypeScript (vscode-js-debug)
- Go (delve)
- Rust (lldb)
- Java (jdtls)
- PHP (vscode-php-debug)

## ğŸ“¦ å®‰è£…è°ƒè¯•å™¨

### 1. ç¡®ä¿ Vimspector å·²å®‰è£…

```vim
vim
:PlugInstall
```

### 2. å®‰è£…è¯­è¨€é€‚é…å™¨

åœ¨ Vim ä¸­æ‰§è¡Œï¼š

```vim
" å®‰è£…æ‰€æœ‰å¸¸ç”¨é€‚é…å™¨
:VimspectorInstall

" æˆ–å®‰è£…ç‰¹å®šè¯­è¨€
:VimspectorInstall debugpy         " Python
:VimspectorInstall vscode-cpptools " C/C++
:VimspectorInstall CodeLLDB        " Rust/C/C++
:VimspectorInstall vscode-node-debug2  " Node.js
```

### 3. æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå®‰è£…

```bash
# è¿›å…¥ Vimspector ç›®å½•
cd ~/.vim/plugged/vimspector

# å®‰è£… Python è°ƒè¯•å™¨
./install_gadget.py --enable-python

# å®‰è£… C/C++ è°ƒè¯•å™¨
./install_gadget.py --enable-c --enable-cpp

# å®‰è£…æ‰€æœ‰
./install_gadget.py --all
```

## âŒ¨ï¸ è°ƒè¯•å¿«æ·é”®

### F é”®å¿«æ·é”®ï¼ˆå·²é…ç½®ï¼‰

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `F5` | ç»§ç»­/å¯åŠ¨ | Continue / Launch |
| `F3` | åœæ­¢è°ƒè¯• | Stop |
| `F4` | é‡å¯è°ƒè¯• | Restart |
| `F6` | æš‚åœ | Pause |
| `F9` | åˆ‡æ¢æ–­ç‚¹ | Toggle Breakpoint |
| `F10` | å•æ­¥è·¨è¶Š | Step Over |
| `F11` | å•æ­¥è¿›å…¥ | Step Into |
| `F12` | å•æ­¥è·³å‡º | Step Out |

### Leader é”®å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Space + d + u` | åˆ‡æ¢è°ƒè¯• UI |
| `Space + d + r` | é‡ç½®è°ƒè¯•å™¨ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Python è°ƒè¯•ç¤ºä¾‹

1. **åˆ›å»ºæµ‹è¯•æ–‡ä»¶**

```bash
cat > test.py << 'EOF'
def calculate(a, b):
    result = a + b
    return result

def main():
    x = 5
    y = 10
    z = calculate(x, y)
    print(f"Result: {z}")

if __name__ == "__main__":
    main()
EOF
```

2. **åˆ›å»ºè°ƒè¯•é…ç½®**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.vimspector.json`ï¼š

```bash
cat > .vimspector.json << 'EOF'
{
  "configurations": {
    "Python - Launch": {
      "adapter": "debugpy",
      "configuration": {
        "request": "launch",
        "program": "${file}",
        "stopOnEntry": false,
        "console": "integratedTerminal"
      }
    }
  }
}
EOF
```

3. **å¼€å§‹è°ƒè¯•**

```vim
vim test.py

" åœ¨æŸè¡Œè®¾ç½®æ–­ç‚¹ï¼ˆå¦‚ç¬¬ 3 è¡Œï¼‰
:3
F9        " è®¾ç½®æ–­ç‚¹

" å¯åŠ¨è°ƒè¯•
F5        " é€‰æ‹© "Python - Launch"

" ä½¿ç”¨è°ƒè¯•å‘½ä»¤
F10       " å•æ­¥è·¨è¶Š
F11       " å•æ­¥è¿›å…¥
F12       " å•æ­¥è·³å‡º
F5        " ç»§ç»­æ‰§è¡Œ
```

### C/C++ è°ƒè¯•ç¤ºä¾‹

1. **åˆ›å»ºæµ‹è¯•æ–‡ä»¶**

```bash
cat > test.cpp << 'EOF'
#include <iostream>

int add(int a, int b) {
    int result = a + b;
    return result;
}

int main() {
    int x = 5;
    int y = 10;
    int z = add(x, y);
    std::cout << "Result: " << z << std::endl;
    return 0;
}
EOF
```

2. **åˆ›å»ºè°ƒè¯•é…ç½®**

```bash
cat > .vimspector.json << 'EOF'
{
  "configurations": {
    "C++ - Launch": {
      "adapter": "vscode-cpptools",
      "configuration": {
        "request": "launch",
        "program": "${workspaceRoot}/a.out",
        "args": [],
        "cwd": "${workspaceRoot}",
        "environment": [],
        "externalConsole": false,
        "MIMode": "gdb",
        "setupCommands": [
          {
            "description": "Enable pretty-printing for gdb",
            "text": "-enable-pretty-printing",
            "ignoreFailures": true
          }
        ]
      }
    }
  }
}
EOF
```

3. **ç¼–è¯‘å¹¶è°ƒè¯•**

```bash
# ç¼–è¯‘ï¼ˆå¸¦è°ƒè¯•ä¿¡æ¯ï¼‰
g++ -g test.cpp -o a.out

# æ‰“å¼€ Vim è°ƒè¯•
vim test.cpp

" è®¾ç½®æ–­ç‚¹
:5        # è·³åˆ°ç¬¬ 5 è¡Œ
F9        # è®¾ç½®æ–­ç‚¹

" å¯åŠ¨è°ƒè¯•
F5        # é€‰æ‹© "C++ - Launch"
```

## ğŸ¯ è°ƒè¯• UI è¯´æ˜

å¯åŠ¨è°ƒè¯•åï¼ŒVimspector ä¼šæ‰“å¼€å¤šä¸ªçª—å£ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚  Variables      â”‚ å˜é‡çª—å£
â”‚   Source Code       â”‚  (å±€éƒ¨å˜é‡)     â”‚
â”‚   (æºä»£ç )          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚  Watches        â”‚ ç›‘è§†çª—å£
â”‚   <- å½“å‰è¡Œ         â”‚  (ç›‘è§†è¡¨è¾¾å¼)   â”‚
â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚  Stack Trace    â”‚ è°ƒç”¨æ ˆ
â”‚                     â”‚  (å‡½æ•°è°ƒç”¨æ ˆ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  Console / Output   (æ§åˆ¶å°è¾“å‡º)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çª—å£è¯´æ˜

- **Variables**: æ˜¾ç¤ºå½“å‰ä½œç”¨åŸŸçš„å±€éƒ¨å˜é‡
- **Watches**: æ˜¾ç¤ºä½ æ·»åŠ çš„ç›‘è§†è¡¨è¾¾å¼
- **Stack Trace**: å‡½æ•°è°ƒç”¨æ ˆ
- **Console**: ç¨‹åºè¾“å‡ºå’Œè°ƒè¯•ä¿¡æ¯

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

### åœ¨ Vim å‘½ä»¤æ¨¡å¼ä¸‹

```vim
" æ–­ç‚¹ç®¡ç†
:VimspectorBreakpoints          " æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹
:call vimspector#ClearBreakpoints()  " æ¸…é™¤æ‰€æœ‰æ–­ç‚¹

" ç›‘è§†è¡¨è¾¾å¼
:VimspectorWatch <expression>   " æ·»åŠ ç›‘è§†

" æ±‚å€¼
:VimspectorEval <expression>    " æ±‚å€¼è¡¨è¾¾å¼

" è°ƒè¯•æ§åˆ¶
:VimspectorReset                " é‡ç½®è°ƒè¯•å™¨
:VimspectorStop                 " åœæ­¢è°ƒè¯•
```

### åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­

- å…‰æ ‡ç§»åˆ°å˜é‡ä¸Šï¼Œä¼šæ˜¾ç¤ºå˜é‡å€¼
- åœ¨ Console çª—å£å¯ä»¥è¾“å…¥è°ƒè¯•å‘½ä»¤
- å¯ä»¥ä¿®æ”¹å˜é‡å€¼

## ğŸ”§ é«˜çº§é…ç½®

### ä¸ºä¸åŒåœºæ™¯åˆ›å»ºå¤šä¸ªé…ç½®

`.vimspector.json`:

```json
{
  "configurations": {
    "Python - Launch Current File": {
      "adapter": "debugpy",
      "configuration": {
        "request": "launch",
        "program": "${file}"
      }
    },
    "Python - Attach": {
      "adapter": "debugpy",
      "configuration": {
        "request": "attach",
        "host": "localhost",
        "port": 5678
      }
    },
    "Python - Django": {
      "adapter": "debugpy",
      "configuration": {
        "request": "launch",
        "program": "${workspaceRoot}/manage.py",
        "args": ["runserver", "--noreload"]
      }
    }
  }
}
```

### æ¡ä»¶æ–­ç‚¹

åœ¨è®¾ç½®æ–­ç‚¹çš„è¡Œæ‰§è¡Œï¼š

```vim
:call vimspector#SetLineBreakpoint(expand('%'), line('.'), {'condition': 'x > 10'})
```

### æ—¥å¿—æ–­ç‚¹

```vim
:call vimspector#SetLineBreakpoint(expand('%'), line('.'), {'logMessage': 'x = {x}'})
```

## ğŸ“ è°ƒè¯•å·¥ä½œæµ

### å…¸å‹è°ƒè¯•æµç¨‹

1. **è®¾ç½®æ–­ç‚¹** - `F9`
2. **å¯åŠ¨è°ƒè¯•** - `F5`
3. **æŸ¥çœ‹å˜é‡** - åœ¨ Variables çª—å£
4. **å•æ­¥æ‰§è¡Œ** - `F10` (è·¨è¶Š) / `F11` (è¿›å…¥)
5. **æŸ¥çœ‹è°ƒç”¨æ ˆ** - Stack Trace çª—å£
6. **æ·»åŠ ç›‘è§†** - `:VimspectorWatch variable_name`
7. **ç»§ç»­æ‰§è¡Œ** - `F5`
8. **åœæ­¢è°ƒè¯•** - `F3`

### è°ƒè¯•æŠ€å·§

1. **å¿«é€Ÿå®šä½é—®é¢˜**
   - åœ¨å¯èƒ½å‡ºé”™çš„åœ°æ–¹è®¾ç½®æ–­ç‚¹
   - æŸ¥çœ‹å˜é‡å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸ
   - æ£€æŸ¥è°ƒç”¨æ ˆäº†è§£æ‰§è¡Œè·¯å¾„

2. **æ¡ä»¶æ–­ç‚¹**
   - åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æš‚åœ
   - é¿å…åœ¨å¾ªç¯ä¸­é¢‘ç¹ä¸­æ–­

3. **ç›‘è§†è¡¨è¾¾å¼**
   - ç›‘è§†å¤æ‚è¡¨è¾¾å¼çš„å€¼
   - å®æ—¶æŸ¥çœ‹è®¡ç®—ç»“æœ

4. **è°ƒç”¨æ ˆå¯¼èˆª**
   - æŸ¥çœ‹å‡½æ•°è°ƒç”¨é“¾
   - ç†è§£ä»£ç æ‰§è¡Œæµç¨‹

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šè°ƒè¯•å™¨å¯åŠ¨å¤±è´¥

**è§£å†³**ï¼š
1. æ£€æŸ¥æ˜¯å¦å®‰è£…äº†é€‚é…å™¨ï¼š
   ```vim
   :VimspectorInstall debugpy
   ```

2. æ£€æŸ¥ `.vimspector.json` é…ç½®æ˜¯å¦æ­£ç¡®

3. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼š
   ```vim
   :messages
   ```

### é—®é¢˜ï¼šæ–­ç‚¹ä¸ç”Ÿæ•ˆ

**è§£å†³**ï¼š
1. ç¡®ä¿æ–‡ä»¶å·²ç¼–è¯‘ï¼ˆC/C++ï¼‰
2. ç¡®ä¿ç¼–è¯‘æ—¶åŒ…å«è°ƒè¯•ä¿¡æ¯ (`-g`)
3. æ£€æŸ¥æºæ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šçœ‹ä¸åˆ°å˜é‡å€¼

**è§£å†³**ï¼š
1. ç¡®ä¿åœ¨æ–­ç‚¹å¤„æš‚åœ
2. æ£€æŸ¥å˜é‡æ˜¯å¦åœ¨å½“å‰ä½œç”¨åŸŸ
3. å°è¯•åœ¨ Console æ‰‹åŠ¨æ±‚å€¼

## ğŸ“š é…ç½®æ¨¡æ¿

### Python é¡¹ç›®æ¨¡æ¿

```json
{
  "configurations": {
    "Python: Current File": {
      "adapter": "debugpy",
      "configuration": {
        "request": "launch",
        "type": "python",
        "cwd": "${workspaceRoot}",
        "program": "${file}",
        "stopOnEntry": false,
        "console": "integratedTerminal"
      }
    }
  }
}
```

### C/C++ é¡¹ç›®æ¨¡æ¿

```json
{
  "configurations": {
    "C++: Launch": {
      "adapter": "vscode-cpptools",
      "configuration": {
        "request": "launch",
        "program": "${workspaceRoot}/build/program",
        "args": [],
        "cwd": "${workspaceRoot}",
        "environment": [],
        "externalConsole": false,
        "MIMode": "gdb"
      }
    }
  }
}
```

### Node.js é¡¹ç›®æ¨¡æ¿

```json
{
  "configurations": {
    "Node: Launch": {
      "adapter": "vscode-node",
      "configuration": {
        "request": "launch",
        "protocol": "auto",
        "program": "${workspaceRoot}/index.js",
        "cwd": "${workspaceRoot}"
      }
    }
  }
}
```

## ğŸ’¡ æç¤º

- ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰è®°å¾—å®‰è£…é€‚é…å™¨ï¼š`:VimspectorInstall`
- æŒ‰ `F9` å¿«é€Ÿè®¾ç½®/å–æ¶ˆæ–­ç‚¹
- ä½¿ç”¨ `Space + d + u` åˆ‡æ¢è°ƒè¯• UI çš„æ˜¾ç¤º/éšè—
- è°ƒè¯•å®Œæˆåç”¨ `F3` åœæ­¢ï¼Œæˆ– `:VimspectorReset` é‡ç½®
- å¯ä»¥åœ¨ Variables çª—å£å±•å¼€å¤æ‚å¯¹è±¡æŸ¥çœ‹å†…éƒ¨ç»“æ„

## ğŸ”— æ›´å¤šèµ„æº

- Vimspector æ–‡æ¡£: `:help vimspector`
- GitHub: https://github.com/puremourning/vimspector
- é…ç½®ç¤ºä¾‹: `~/.vim/plugged/vimspector/support/test/`

---

**ç°åœ¨å°±è¯•è¯•è°ƒè¯•åŠŸèƒ½å§ï¼** ğŸ›ğŸ”
